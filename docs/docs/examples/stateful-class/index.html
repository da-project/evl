<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.85.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/evl/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/evl/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/evl/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/evl/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/evl/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/evl/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/evl/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/evl/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/evl/favicons/android-192x192.png" sizes="192x192">

<title>Stateful class | </title><meta property="og:title" content="Stateful class" />
<meta property="og:description" content="The EVL library is very flexible and offers many ways to use the multimethods. Here we show how to define a stateful class with protected access to a multimethod.
This is a concrete example on how to use a multimethod for managing an inner state. It is based on protected access.
The idea here is to define a person finder that will return a location based on different criteria: weather, person, hour." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/evl/docs/examples/stateful-class/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2021-07-14T16:18:43+02:00" />

<meta itemprop="name" content="Stateful class">
<meta itemprop="description" content="The EVL library is very flexible and offers many ways to use the multimethods. Here we show how to define a stateful class with protected access to a multimethod.
This is a concrete example on how to use a multimethod for managing an inner state. It is based on protected access.
The idea here is to define a person finder that will return a location based on different criteria: weather, person, hour.">
<meta itemprop="dateModified" content="2021-07-14T16:18:43+02:00" />
<meta itemprop="wordCount" content="664">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Stateful class"/>
<meta name="twitter:description" content="The EVL library is very flexible and offers many ways to use the multimethods. Here we show how to define a stateful class with protected access to a multimethod.
This is a concrete example on how to use a multimethod for managing an inner state. It is based on protected access.
The idea here is to define a person finder that will return a location based on different criteria: weather, person, hour."/>





<link rel="preload" href="/evl/scss/main.min.c2bc299561c13b716c290596e31271cf5bf0df216ba54fc62f4082b28487f946.css" as="style">
<link href="/evl/scss/main.min.c2bc299561c13b716c290596e31271cf5bf0df216ba54fc62f4082b28487f946.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
<style>

	a {
		color: #b91515;
	}
	
	.btn-get-started {
		background: #5c5e5a;
		color: white;
	}
	
	.btn-use-it {
		background: #800000;
		color: white;
	}

</style>


    <title>Stateful class | </title>
  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/evl/">
		<span class="navbar-logo"><svg xmlns:ooo="http://xml.openoffice.org/svg/export" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.2" width="172" height="172" viewBox="7450 5250 4300 4300" preserveAspectRatio="xMidYMid" id="svg479" sodipodi:docname="Logo.svg" style="fill-rule:evenodd;stroke-width:28.22200012;stroke-linejoin:round" inkscape:version="0.92.4 (5da689c313, 2019-01-14)"><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1920" inkscape:window-height="1017" id="namedview481" showgrid="false" units="px" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="5.2301357" inkscape:cx="81.259843" inkscape:cy="90.740159" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="svg479"/><defs class="ClipPathGroup" id="defs373"><clipPath id="presentation_clip_path" clipPathUnits="userSpaceOnUse"><rect x="7450" y="5250" width="4300" height="4300" id="rect370"/></clipPath></defs><defs id="defs382"><font id="EmbeddedFont_1" horiz-adv-x="2048" horiz-origin-x="0" horiz-origin-y="0" vert-origin-x="45" vert-origin-y="90" vert-adv-y="90"><font-face font-family="Lucida Console embedded" units-per-em="2048" font-weight="bold" font-style="normal" ascent="1614" descent="423" id="font-face375"/><missing-glyph horiz-adv-x="2048" d="M0 0H2047V2047H0V0z" id="missing-glyph377"/><glyph unicode="Îµ" horiz-adv-x="954" d="M1091 225V41C972-3 850-25 725-25 539-25 397 26 297 127 198 228 148 373 148 561c0 166 44 3e2 131 4e2 53 61 116 104 187 129 72 25 165 38 279 38 112 0 223-13 333-40V895c-135 32-244 48-329 48-222 0-341-92-356-275h625V483H393c9-107 42-188 1e2-242 59-54 149-81 271-81 103 0 212 22 327 65z" id="glyph379"/></font></defs><defs id="defs393"><font id="EmbeddedFont_2" horiz-adv-x="2048" horiz-origin-x="0" horiz-origin-y="0" vert-origin-x="45" vert-origin-y="90" vert-adv-y="90"><font-face font-family="Malgun Gothic embedded" units-per-em="2048" font-weight="bold" font-style="normal" ascent="2196" descent="503" id="font-face384"/><missing-glyph horiz-adv-x="2048" d="M0 0H2047V2047H0V0z" id="missing-glyph386"/><glyph unicode="v" horiz-adv-x="1086" d="M1096 1051 696 0H387L7 1051H307L514 369c19-65 31-123 36-174h5c5 50 17 106 36 169l213 687h292z" id="glyph388"/><glyph unicode="l" horiz-adv-x="266" d="M142 0V1555H420V0H142z" id="glyph390"/></font></defs><defs class="TextShapeIndex" id="defs397"><g ooo:slide="id1" ooo:id-list="id3 id4 id5" id="g395"/></defs><defs class="EmbeddedBulletChars" id="defs426"><g id="bullet-char-template(57356)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M580 1141l583-570L580 0-4 571z" id="path399" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(57354)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M8 1128H1137V0H8z" id="path402" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(10146)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M174 0 602 739 174 1481 1456 739zM1358 739 309 1346 659 739z" id="path405" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(10132)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M2015 739 1276 0H717l543 543H174v393h1086l-543 545h557z" id="path408" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(10007)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="m0-2c-7 16-16 29-25 39l381 530c-94 256-141 385-141 387 0 25 13 38 40 38 9 0 21-2 34-5 21 4 42 12 65 25l27-13 111-251 280 301 64-25 24 25c21-10 41-24 62-43-36-69-87-143-152-222-1-1-60-68-176-2e2L774 223c0-27-21-55-63-84l16-20c-10-29-28-43-55-43-31 0-102 102-215 305L164-76c-22-34-53-51-92-51-42 0-63 17-64 51C1-67-2-52-2-32c0 9 1 19 2 30z" id="path411" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(10004)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M285-33C182-33 111 30 74 156 52 228 41 333 41 471c0 78 14 145 41 201 34 71 87 106 158 106 53 0 88-31 106-94l23-176c8-64 28-97 59-98l735 706c11 11 33 17 66 17 42 0 63-15 63-46V965c0-36-10-64-30-84L442 47C390-6 338-33 285-33z" id="path414" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(9679)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M813 0C632 0 489 54 383 161 276 268 223 411 223 592s53 324 160 431c106 107 249 161 430 161 179 0 323-54 432-161 108-107 162-251 162-431s-54-324-162-431C1136 54 992 0 813 0z" id="path417" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(8226)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="m346 457c-73 0-137 26-191 78-54 51-81 114-81 188 0 73 27 136 81 188s118 78 191 78 134-26 185-79c51-51 77-114 77-187 0-75-25-137-76-188-50-52-112-78-186-78z" id="path420" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(8211)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M-4 459H1135V606H-4z" id="path423" inkscape:connector-curvature="0"/></g></defs><defs class="TextEmbeddedBitmaps" id="defs428"/><g class="SlideGroup" id="g477"><g id="g475"><g id="id1" class="Slide" clip-path="url(#presentation_clip_path)"><g class="Page" id="g472"><g class="com.sun.star.drawing.CustomShape" id="g444"><g id="id3"><g id="g439"><defs id="defs435"><linearGradient id="gradient1" x1="8165" y1="4915" x2="11035" y2="9885" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:#babdb6" id="stop430"/><stop offset="1" style="stop-color:#555753" id="stop432"/></linearGradient></defs><path style="fill:url(#gradient1)" d="M96e2 95e2H75e2V53e2h42e2v42e2z" id="path437" inkscape:connector-curvature="0"/></g><path d="M96e2 95e2H75e2V53e2h42e2v42e2z" id="path441" inkscape:connector-curvature="0" style="fill:none;stroke:#b91515;stroke-width:100;stroke-linejoin:miter"/></g></g><g class="com.sun.star.drawing.TextShape" id="g457"><g id="id4"><text class="TextShape" id="text454"><tspan class="TextParagraph" font-size="3387" font-weight="700" id="tspan452" style="font-weight:700;font-size:3387px;font-family:lucida console,monospace"><tspan class="TextPosition" x="7700" y="8296" id="tspan446"/><tspan class="TextPosition" x="7700" y="8296" id="tspan450"><tspan id="tspan448" style="fill:maroon;stroke:none">Îµ</tspan></tspan></tspan></text></g></g><g class="com.sun.star.drawing.TextShape" id="g470"><g id="id5"><text class="TextShape" id="text467"><tspan class="TextParagraph" font-size="2046" font-weight="700" id="tspan465" style="font-weight:700;font-size:2046px;font-family:malgun gothic,sans-serif"><tspan class="TextPosition" x="9700" y="8252" id="tspan459"/><tspan class="TextPosition" x="9700" y="8252" id="tspan463"><tspan id="tspan461" style="fill:#540000;stroke:none">vl</tspan></tspan></tspan></text></g></g></g></g></g></g></svg></span><span class="text-uppercase font-weight-bold"></span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/evl/docs/about/" ><span>What is EVL?</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/evl/docs/" ><span>Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://github.com/ylegoc/evl" target="_blank" ><span>GitHub</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"></div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a>
  </li>
  <ul>
    <li class="collapse show" id="evldocs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/about/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">What is EVL?</a>
  </li>
  <ul>
    <li class="collapse " id="evldocsabout">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/use/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">How to use EVL</a>
  </li>
  <ul>
    <li class="collapse " id="evldocsuse">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/the-multimethods/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">The multimethods</a>
  </li>
  <ul>
    <li class="collapse " id="evldocsthe-multimethods">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodsbase-transform" href="/evl/docs/the-multimethods/base-transform/">The base transform</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodsdimension-two" href="/evl/docs/the-multimethods/dimension-two/">In two dimensions</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodsbest-match" href="/evl/docs/the-multimethods/best-match/">Best match</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodschange-comparator" href="/evl/docs/the-multimethods/change-comparator/">Change comparator</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodsambiguity-resolution" href="/evl/docs/the-multimethods/ambiguity-resolution/">Ambiguity resolution</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodsmore-dimensions" href="/evl/docs/the-multimethods/more-dimensions/">More dimensions</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/theory/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Theory</a>
  </li>
  <ul>
    <li class="collapse " id="evldocstheory">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheorytuple-distance" href="/evl/docs/theory/tuple-distance/">Tuple of types distance</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheorydistance-comparators" href="/evl/docs/theory/distance-comparators/">Distance comparators</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheorymultimethod-definition" href="/evl/docs/theory/multimethod-definition/">Multimethod definition</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheorysearch-best-match" href="/evl/docs/theory/search-best-match/">Search for the best match</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheoryinvoke" href="/evl/docs/theory/invoke/">Invoke with cache</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheoryasymmetric-vs-symmetric" href="/evl/docs/theory/asymmetric-vs-symmetric/">Asymmetric vs symmetric</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/more-features/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">More features</a>
  </li>
  <ul>
    <li class="collapse " id="evldocsmore-features">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuressuper-commands" href="/evl/docs/more-features/super-commands/">Super commands</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuresinterfaces" href="/evl/docs/more-features/interfaces/">Interfaces</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuresreturn-type-parameters" href="/evl/docs/more-features/return-type-parameters/">Return type and parameters</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuresswitch" href="/evl/docs/more-features/switch/">Switch</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuresopen-access" href="/evl/docs/more-features/open-access/">Open access</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuresprotected-access" href="/evl/docs/more-features/protected-access/">Protected access</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featurescontrolled-extension" href="/evl/docs/more-features/controlled-extension/">Controlled extension</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featureserrors" href="/evl/docs/more-features/errors/">Errors</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/examples/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Examples</a>
  </li>
  <ul>
    <li class="collapse show" id="evldocsexamples">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplespreliminaries" href="/evl/docs/examples/preliminaries/">Preliminaries</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesvisitor" href="/evl/docs/examples/visitor/">Visitor</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-evldocsexamplesstateful-class" href="/evl/docs/examples/stateful-class/">Stateful class</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplescomposition" href="/evl/docs/examples/composition/">Composition</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesstate" href="/evl/docs/examples/state/">State</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplescomparator" href="/evl/docs/examples/comparator/">Comparator</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesstrategy" href="/evl/docs/examples/strategy/">Strategy</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesfactory" href="/evl/docs/examples/factory/">Factory</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesobserver" href="/evl/docs/examples/observer/">Observer</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesqueue" href="/evl/docs/examples/queue/">Queue</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplestostring" href="/evl/docs/examples/tostring/">ToString</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplestreewalker" href="/evl/docs/examples/treewalker/">Tree walker</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/why/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Why use EVL?</a>
  </li>
  <ul>
    <li class="collapse " id="evldocswhy">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            









<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#base-implementation">Base implementation</a></li>
        <li><a href="#extension">Extension</a></li>
      </ul>
    </li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="/evl/docs/">Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="/evl/docs/examples/">Examples</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/evl/docs/examples/stateful-class/">Stateful class</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>Stateful class</h1>
	
	<p>The EVL library is very flexible and offers many ways to use the multimethods.
Here we show how to define a stateful class with protected access to a multimethod.</p>
<p>This is a concrete example on how to use a multimethod for managing an inner state. It is based on <a href="/docs/more-features/protected-access/">protected access</a>.</p>
<p>The idea here is to define a person finder that will return a location based on different criteria: weather, person, hour.
The classes used in the example are defined in the <a href="/docs/examples/preliminaries/">preliminaries</a>.</p>
<h3 id="base-implementation">Base implementation</h3>
<p>Here is the implementation of the <em>PersonFinder</em> class:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#00a">public</span> <span style="color:#00a">class</span> <span style="color:#0a0;text-decoration:underline">PersonFinder</span> {
	
	<span style="color:#00a">protected</span> Method2&lt;Location&gt; m = <span style="color:#00a">new</span> Method2&lt;Location&gt;();
	<span style="color:#00a">protected</span> Weather weather = <span style="color:#00a">new</span> Sunny();
	
	<span style="color:#00a">public</span> <span style="color:#0a0">PersonFinder</span>() {
		m.<span style="color:#1e90ff">add</span>(<span style="color:#00a">this</span>, <span style="color:#a50">&#34;findMatch&#34;</span>);
	}
	
	<span style="color:#00a">public</span> <span style="color:#0aa">void</span> <span style="color:#0a0">setSunnyWeather</span>() {
		weather = <span style="color:#00a">new</span> Sunny();
	}
	
	<span style="color:#00a">public</span> <span style="color:#0aa">void</span> <span style="color:#0a0">setRainyWeather</span>() {
		weather = <span style="color:#00a">new</span> Rainy();
	}
	
	<span style="color:#00a">protected</span> Location <span style="color:#0a0">findMatch</span>(Rainy weather, Kid kid, <span style="color:#0aa">int</span> hour) {
		<span style="color:#00a">return</span> <span style="color:#00a">new</span> Inside();
	}
	
	<span style="color:#00a">protected</span> Location <span style="color:#0a0">findMatch</span>(Sunny weather, Kid kid, <span style="color:#0aa">int</span> hour) {
		<span style="color:#00a">if</span> (hour &gt; 14 &amp;&amp; hour &lt; 16) {
			<span style="color:#00a">return</span> <span style="color:#00a">new</span> Outside();
		}
		<span style="color:#00a">return</span> <span style="color:#00a">new</span> Inside();
	}
	
	<span style="color:#00a">protected</span> Location <span style="color:#0a0">findMatch</span>(Rainy weather, Teen teen, <span style="color:#0aa">int</span> hour) {
		<span style="color:#00a">if</span> (hour &gt; 8 &amp;&amp; hour &lt; 17) {
			<span style="color:#00a">return</span> <span style="color:#00a">new</span> Outside();
		}
		<span style="color:#00a">return</span> <span style="color:#00a">new</span> Inside();
	}
	
	<span style="color:#00a">protected</span> Location <span style="color:#0a0">findMatch</span>(Sunny weather, Teen teen, <span style="color:#0aa">int</span> hour) {
		<span style="color:#00a">if</span> (hour &gt; 8 &amp;&amp; hour &lt; 19) {
			<span style="color:#00a">return</span> <span style="color:#00a">new</span> Outside();
		}
		<span style="color:#00a">return</span> <span style="color:#00a">new</span> Inside();
	}
	
	<span style="color:#00a">public</span> Location <span style="color:#0a0">find</span>(Person person, <span style="color:#0aa">int</span> hour) {
		
		<span style="color:#00a">try</span> {
			<span style="color:#00a">return</span> m.<span style="color:#1e90ff">invoke</span>(weather, person, hour);
		}
		<span style="color:#00a">catch</span> (Throwable e) {
			<span style="color:#00a">return</span> <span style="color:#00a">new</span> Somewhere();
		}
	}
}
</code></pre></div><p>The class has two members:</p>
<ul>
<li>The multimethod <em>m</em> of dimension two.</li>
<li>The inner <em>weather</em> state.</li>
</ul>
<p>The <em>weather</em> state can be changed publicly with the two methods <em>setSunnyWeather()</em> and <em>setRainyWeather()</em>.
The multimethod <em>m</em> is configured in the constructor by registering the match methods that are all the methods with the name &ldquo;findMatch&rdquo;.
Then the <em>findMatch()</em> methods are defined and based on two virtual parameters - <em>weather</em> and <em>kid</em> or <em>teen</em>. They implement the find location rules.
To finish the public <em>find()</em> method is exposed which forwards the call to <em>m</em>.</p>
<p>In action:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">PersonFinder finder = <span style="color:#00a">new</span> PersonFinder();
			
System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Person is &#34;</span> + finder.<span style="color:#1e90ff">find</span>(<span style="color:#00a">new</span> Kid(6), 10));
System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Person is &#34;</span> + finder.<span style="color:#1e90ff">find</span>(<span style="color:#00a">new</span> Teen(Sex.<span style="color:#1e90ff">GIRL</span>), 10));

finder.<span style="color:#1e90ff">setRainyWeather</span>();

System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Person is &#34;</span> + finder.<span style="color:#1e90ff">find</span>(<span style="color:#00a">new</span> Kid(6), 18));
System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Person is &#34;</span> + finder.<span style="color:#1e90ff">find</span>(<span style="color:#00a">new</span> Teen(Sex.<span style="color:#1e90ff">GIRL</span>), 18));
System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Person is &#34;</span> + finder.<span style="color:#1e90ff">find</span>(<span style="color:#00a">new</span> Adult(), 18));
</code></pre></div><p>How would you have implemented such rules without multimethods? Probably by defining the weather state with an integral type (boolean, enum, integer) and using some <em>if</em> or <em>switch</em> statements.
Maybe you would have kept a class definition and use the <em>instanceof</em> operator.</p>
<p>What is sure is that there is no way to properly define some rules based on two class dimensions with standard &ldquo;virtual&rdquo; methods.</p>
<h3 id="extension">Extension</h3>
<p>What is interesting with multimethods is that they are very easily extended.</p>
<p>We want to extend the <em>PersonFinder</em> class by adding some rules concerning the <em>Adult</em> person. For that we simply define a new class that extends <em>PersonFinder</em>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#00a">public</span> <span style="color:#00a">class</span> <span style="color:#0a0;text-decoration:underline">AdultPersonFinder</span> <span style="color:#00a">extends</span> PersonFinder {

	<span style="color:#00a">protected</span> Location <span style="color:#0a0">findMatch</span>(Weather weather, Adult adult, <span style="color:#0aa">int</span> hour) {
		<span style="color:#00a">if</span> (hour &gt; 8 &amp;&amp; hour &lt; 20) {
			<span style="color:#00a">return</span> <span style="color:#00a">new</span> Outside();
		}
		<span style="color:#00a">return</span> <span style="color:#00a">new</span> Inside();
	}
}
</code></pre></div><p>The only thing we have to do is define a new <em>findMatch()</em> method with the desired virtual parameter couples, i.e. <em>Weather</em> and <em>Adult</em> in our case.
The match method is automatically registered.</p>
<p>In action:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">PersonFinder finder = <span style="color:#00a">new</span> AdultPersonFinder();
			
System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Person is &#34;</span> + finder.<span style="color:#1e90ff">find</span>(<span style="color:#00a">new</span> Adult(), 21));
</code></pre></div><p>How would you have implemented the extension with an <em>if</em> or <em>switch</em> statements? Multimethods show that the extension is natural.</p>
<p>To conclude, this example is showing how to define rules based on three parameters:</p>
<ul>
<li>One <strong>virtual</strong> state of the class</li>
<li>One <strong>virtual</strong> parameter outside the class</li>
<li>One <strong>non-virtual</strong> parameter</li>
</ul>
<p>It is easy to imagine that a general stateful class would use <em>M</em> virtual states, <em>N</em> virtual parameters outside, <em>P</em> non-virtual parameters.
Of course, increase the number of virtual parameters can lead to some rules difficult to understand but the multimethods support it.
It is up to you to find good designs.</p>

	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified July 14, 2021: <a  href="/commit/f597b6297096901cb91b597221820abf93572f25">Removed MultiMethod.access() calls as it is done in MultiMethod add methods. (f597b62)</a>
</div>
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/ylegoc/evl">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 The EVL Authors All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>






<script src="/evl/js/main.min.9bf7aaf346c408e3f77ec60207f33b92923a9e8f34edb7aee06a12ce9a06e469.js" integrity="sha256-m/eq80bECOP3fsYCB/M7kpI6no807beu4GoSzpoG5Gk=" crossorigin="anonymous"></script>



  </body>
</html>